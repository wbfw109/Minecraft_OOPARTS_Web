from twisted.web import server
from twisted.web.wsgi import WSGIResource
from twisted.internet import reactor
from twisted.web.resource import Resource
# from twisted.internet import endpoints
from twisted.python.log import startLogging
from twisted.python import log, logfile
from django.core.wsgi import get_wsgi_application
import os, sys

sys.path.insert(0, 'O:/Visual_Studio_2017/source/repos/Minecraft_OOPARTS_Web/Minecraft_OOPARTS_Web')
from Minecraft_OOPARTS_Web import wsgi



resource = WSGIResource(reactor, reactor.getThreadPool(), wsgi.application)
site = server.Site(resource)


startLogging(sys.stdout)                                # logging to console
logFile = logfile.LogFile.fromFullPath('O:/Visual_Studio_2017/source/repos/Minecraft_OOPARTS_Web/Minecraft_OOPARTS_Web/log/daily.log')   # logging to file
log.addObserver(log.FileLogObserver(logFile).emit)


reactor.listenTCP(8081, site)   # TCP set

# reactor.listenTCP(8081, site, ssl.DefaultOpenSSLContextFactory( 'F:/Research/Security/SSL/SSL_key/private.pem', 'F:/Research/Security/SSL/SSL_key/certificate.pem'))   # TCP set
reactor.run()                   # start server



    

"""
pip install pyopenssl twisted[http2]
UserWarning: You do not have a working installation of the service_identity module: 'No module named 'service_identity''.
  Please install it from <https://pypi.python.org/pypi/service_identity> and make sure all of its dependencies are satisfied.
  Without the service_identity module, Twisted can perform only rudimentary TLS client hostname verification.


    root = Resource()
    root.putChild(b'', File('O:/Visual_Studio_2017/source/repos/Minecraft_OOPARTS_Web/Minecraft_OOPARTS_Web/app/templates'))
    root.putChild(b'static', File('O:/Visual_Studio_2017/source/repos/Minecraft_OOPARTS_Web/Minecraft_OOPARTS_Web/app/static'))
    site = server.Site(root)
    server = endpoints.serverFromString(
        reactor,
        "ssl:port=8081:privateKey=F:/Research/Security/SSL/SSL_key/private.pem:certKey=F:/Research/Security/SSL/certificate.pem",
    )
    server.listen(site)

"""



